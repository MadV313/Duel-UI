<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DayZ CCG Duel Field</title>
  <link rel="stylesheet" href="styles/style.css">
  
  <!-- Scripts -->
  <script type="module" src="scripts/duelState.js" defer></script>
  <script type="module" src="scripts/renderCard.js" defer></script>
  <script type="module" src="scripts/renderHand.js" defer></script>
  <script type="module" src="scripts/renderField.js" defer></script>
  <script type="module" src="scripts/renderDuelUI.js" defer></script>
  <script type="module" src="scripts/animations.js" defer></script>
  <script type="module" src="scripts/coinFlip.js" defer></script>

  <!-- NEW Draw and Turn Scripts -->
  <script defer>
    async function drawCard() {
      const playerId = duelState.currentPlayer;
      const player = duelState.players[playerId];

      if (player.hand.length >= 4) {
        alert("Hand full! Play or discard a card first.");
        return;
      }

      if (duelState.deck.length === 0) {
        alert("Deck empty! You suffer stamina loss!");

        // Stamina Drain (example: -20 HP)
        player.hp -= 20;
        if (player.hp < 0) player.hp = 0; // No negative HP

        updateDuelUI();
        return;
      }

      // Draw main card
      const drawnCard = duelState.deck.shift();
      player.hand.push(drawnCard);

      // Check for Assault Backpack (#054) extra draw
      if (player.field.includes('054')) {
        if (duelState.deck.length > 0) {
          const bonusCard = duelState.deck.shift();
          player.hand.push(bonusCard);
          console.log("Assault Backpack active: Drew extra card.");
        }
      }

      // Check for Tactical Backpack (#056) bonus loot draw
      if (player.field.includes('056') && duelState.lootPile.length > 0) {
        const bonusLootCard = duelState.lootPile.shift();
        player.hand.push(bonusLootCard);
        console.log("Tactical Backpack active: Drew bonus loot card.");
      }

      updateDuelUI();
    }

    async function endTurn() {
      // Advance to next player
      duelState.currentPlayer = duelState.currentPlayer === 'player1' ? 'player2' : 'player1';

      // Reset per-turn states
      duelState.players[duelState.currentPlayer].hasDrawn = false;

      updateDuelUI();
    }

    async function discardCard(playerId, cardIndex) {
      const player = duelState.players[playerId];

      if (cardIndex < 0 || cardIndex >= player.hand.length) {
        alert("Invalid card selection.");
        return;
      }

      const discardedCard = player.hand.splice(cardIndex, 1)[0];
      duelState.discardPile.push(discardedCard);

      console.log(`Player ${playerId} discarded a card: ${discardedCard.name || "Unnamed Card"}`);

      updateDuelUI();
    }
  </script>
</head>
<body>
  <div id="background"></div>

  <div id="player2-hand" class="hand"></div>
  <div id="player2-field" class="field"></div>
  <div id="player2-deck" class="pile">Draw Pile</div>
  <div id="player2-discard" class="pile">Discard Pile</div>

  <div id="player1-field" class="field"></div>
  <div id="player1-hand" class="hand"></div>
  <div id="player1-deck" class="pile">Draw Pile</div>
  <div id="player1-discard" class="pile">Discard Pile</div>

  <div id="controls">
    <button onclick="drawCard()">Draw</button>
    <button onclick="endTurn()">End Turn</button>
    <button onclick="flipCoin()">Flip Coin</button>
  </div>

  <div id="hp-display">
    <div>Player 1 HP: <span id="player1-hp">200</span></div>
    <div>Player 2 HP: <span id="player2-hp">200</span></div>
  </div>

  <div id="turn-display"></div>
</body>
</html>
